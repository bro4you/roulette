<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–†–æ–∑—ã–≥—Ä—ã—à</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@400;700;900&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
:root {
  --gold: #FFD700; --gold2: #FFA500;
  --dark: #08080f; --card: #111118; --border: #222230;
  --text: #e0e0f0; --muted: #555566;
}
body {
  background: var(--dark); color: var(--text);
  font-family: 'Inter', sans-serif;
  min-height: 100vh; display: flex; flex-direction: column;
  align-items: center; overflow-x: hidden; padding-bottom: 24px;
}
body::before {
  content: ''; position: fixed; inset: 0; pointer-events: none;
  background: radial-gradient(ellipse at 70% 10%, rgba(255,215,0,0.05) 0%, transparent 55%),
              radial-gradient(ellipse at 10% 90%, rgba(120,60,255,0.04) 0%, transparent 50%);
}

/* ‚îÄ‚îÄ –≠–ö–†–ê–ù–´ ‚îÄ‚îÄ */
.screen {
  position: fixed; inset: 0; display: flex; flex-direction: column;
  align-items: center; justify-content: center; padding: 20px;
  z-index: 10; transition: opacity 0.3s, transform 0.3s; overflow-y: auto;
}
.screen.hidden { opacity: 0; pointer-events: none; transform: scale(0.97); }

/* ‚îÄ‚îÄ –ü–†–ê–í–ò–õ–ê ‚îÄ‚îÄ */
#rulesScreen { background: var(--dark); }
.rules-logo { font-size: 36px; margin-bottom: 10px; }
.rules-title {
  font-family: 'Unbounded', sans-serif; font-size: 15px; font-weight: 700;
  color: var(--gold); text-align: center; margin-bottom: 16px;
}
.rules-box {
  background: var(--card); border: 1px solid var(--border); border-radius: 14px;
  padding: 16px 18px; width: 100%; max-width: 400px; font-size: 12.5px;
  line-height: 1.7; color: #aaa; margin-bottom: 14px;
  max-height: 52vh; overflow-y: auto;
}
.rules-box b { color: var(--text); }
.rules-box .section { margin-top: 10px; font-weight: 600; color: var(--text); font-size: 12px; }
.rules-box .section:first-child { margin-top: 0; }
.rules-notice {
  background: rgba(255,215,0,0.06); border: 1px solid rgba(255,215,0,0.2);
  border-radius: 10px; padding: 10px 14px; font-size: 11.5px; color: #999;
  max-width: 400px; width: 100%; text-align: center; margin-bottom: 14px; line-height: 1.5;
}
.btn-primary {
  background: linear-gradient(135deg, var(--gold), var(--gold2));
  border: none; border-radius: 14px; padding: 15px 28px;
  font-family: 'Unbounded', sans-serif; font-size: 12px; font-weight: 700;
  color: #000; cursor: pointer; width: 100%; max-width: 400px;
  box-shadow: 0 4px 20px rgba(255,215,0,0.3);
  transition: transform 0.15s, box-shadow 0.15s;
}
.btn-primary:hover { transform: translateY(-1px); box-shadow: 0 6px 28px rgba(255,215,0,0.45); }
.btn-primary:active { transform: translateY(0); }

/* ‚îÄ‚îÄ –†–£–õ–ï–¢–ö–ê ‚îÄ‚îÄ */
#wheelScreen {
  background: var(--dark); justify-content: flex-start;
  padding-top: 16px; overflow-y: auto; position: fixed;
}
.wh-title {
  font-family: 'Unbounded', sans-serif;
  font-size: clamp(14px, 4vw, 20px); font-weight: 900;
  background: linear-gradient(135deg, var(--gold), var(--gold2));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  margin-bottom: 3px; text-align: center;
}
.wh-sub { font-size: 11px; color: var(--muted); margin-bottom: 16px; text-align: center; }

.wheel-wrapper {
  position: relative;
  width: min(360px, 92vw); height: min(360px, 92vw);
  margin: 0 auto 16px; flex-shrink: 0;
}
.wheel-pointer {
  position: absolute; top: -14px; left: 50%; transform: translateX(-50%);
  width: 0; height: 0;
  border-left: 10px solid transparent; border-right: 10px solid transparent;
  border-top: 20px solid var(--gold); z-index: 10;
  filter: drop-shadow(0 0 6px rgba(255,215,0,0.9));
}
canvas {
  border-radius: 50%;
  box-shadow: 0 0 0 3px var(--border), 0 0 32px rgba(255,215,0,0.1);
  display: block;
}
.center-hub {
  position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%);
  width: 60px; height: 60px; border-radius: 50%;
  background: linear-gradient(135deg, var(--gold), var(--gold2));
  display: flex; align-items: center; justify-content: center;
  font-family: 'Unbounded', sans-serif; font-size: 9px; font-weight: 700;
  color: #000; cursor: pointer; border: none; z-index: 5;
  box-shadow: 0 0 18px rgba(255,215,0,0.5); text-align: center; line-height: 1.2;
  transition: transform 0.15s, box-shadow 0.15s;
}
.center-hub:hover:not(:disabled) { transform: translate(-50%,-50%) scale(1.1); }
.center-hub:disabled { opacity: 0.4; cursor: not-allowed; }

.result-card {
  background: var(--card); border: 1px solid var(--border);
  border-radius: 14px; padding: 16px 20px; text-align: center;
  width: 100%; max-width: 360px; flex-shrink: 0;
  transition: border-color 0.4s, box-shadow 0.4s;
}
.result-card.won { border-color: var(--gold); box-shadow: 0 0 20px rgba(255,215,0,0.1); }
.result-label { font-size: 10px; color: var(--muted); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 5px; }
.result-text { font-family: 'Unbounded', sans-serif; font-size: clamp(12px,3.5vw,15px); font-weight: 700; color: var(--gold); line-height: 1.4; }
.result-hint { font-size: 11px; color: var(--muted); margin-top: 5px; }

.btn-claim {
  display: none; margin-top: 12px;
  background: linear-gradient(135deg, var(--gold), var(--gold2));
  border: none; border-radius: 14px; padding: 14px 24px;
  font-family: 'Unbounded', sans-serif; font-size: 11px; font-weight: 700;
  color: #000; cursor: pointer; width: 100%; max-width: 360px;
  box-shadow: 0 4px 18px rgba(255,215,0,0.35);
  animation: btnPulse 1.6s infinite;
}
@keyframes btnPulse {
  0%,100% { box-shadow: 0 4px 18px rgba(255,215,0,0.35); }
  50% { box-shadow: 0 4px 30px rgba(255,215,0,0.65); }
}

/* ‚îÄ‚îÄ –ö–û–ù–§–ï–¢–¢–ò ‚îÄ‚îÄ */
.cf {
  position: fixed; width: 7px; height: 7px; top: -10px;
  border-radius: 2px; pointer-events: none; animation: cfFall linear forwards;
}
@keyframes cfFall { to { transform: translateY(110vh) rotate(720deg); opacity: 0; } }
</style>
</head>
<body>

<!-- –ü–†–ê–í–ò–õ–ê -->
<div class="screen" id="rulesScreen">
  <div class="rules-logo">üé∞</div>
  <div class="rules-title">–ü—Ä–∞–≤–∏–ª–∞ —É—á–∞—Å—Ç–∏—è –≤ –∞–∫—Ü–∏–∏</div>
  <div class="rules-box">
    <div class="section">‚ÑπÔ∏è –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?</div>
    –î–∞–Ω–Ω–∞—è –∞–∫—Ü–∏—è —è–≤–ª—è–µ—Ç—Å—è <b>–º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–æ–π –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏</b> –∏ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∞–∑–∞—Ä—Ç–Ω–æ–π –∏–≥—Ä–æ–π, –ª–æ—Ç–µ—Ä–µ–µ–π –∏–ª–∏ –∏–Ω–æ–π —Ñ–æ—Ä–º–æ–π gambling. –ü—Ä–∏–∑—ã –Ω–æ—Å—è—Ç –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä. –î–µ–Ω–µ–∂–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –Ω–µ –≤–Ω–æ—Å—è—Ç—Å—è –∏ –Ω–µ —Ä–∞–∑—ã–≥—Ä—ã–≤–∞—é—Ç—Å—è.

    <div class="section">üìå –£—Å–ª–æ–≤–∏—è —É—á–∞—Å—Ç–∏—è</div>
    ‚Ä¢ –£—á–∞—Å—Ç–∏–µ ‚Äî –¥–æ–±—Ä–æ–≤–æ–ª—å–Ω–æ–µ –∏ <b>–±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ</b><br>
    ‚Ä¢ <b>1 —É—á–∞—Å—Ç–∏–µ –Ω–∞ 1 –∞–∫–∫–∞—É–Ω—Ç —Ä–∞–∑ –≤ 14 –¥–Ω–µ–π</b><br>
    ‚Ä¢ –ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞<br>
    ‚Ä¢ –£—á–∞—Å—Ç–Ω–∏–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ–ª–µ—Ç–Ω–∏–º

    <div class="section">üèÜ –ü—Ä–∏–∑—ã</div>
    –ü—Ä–∏–∑—ã ‚Äî –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–µ –±–æ–Ω—É—Å—ã: —Å–∫–∏–¥–∫–∏ –∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —É—Å–ª—É–≥–∏. –î–µ–Ω–µ–∂–Ω—ã–π —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç –Ω–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω. –ü–µ—Ä–µ–¥–∞—á–∞ –ø—Ä–∏–∑–∞ —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º –Ω–µ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è. <b>–ë–æ–Ω—É—Å –¥–µ–π—Å—Ç–≤—É–µ—Ç 7 –¥–Ω–µ–π</b> —Å –º–æ–º–µ–Ω—Ç–∞ —Ä–æ–∑—ã–≥—Ä—ã—à–∞, –ø–æ—Å–ª–µ —á–µ–≥–æ —Å–≥–æ—Ä–∞–µ—Ç.

    <div class="section">‚è± –°—Ä–æ–∫ –≤—ã–¥–∞—á–∏</div>
    <b>–î–æ 14 –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã—Ö –¥–Ω–µ–π</b> —Å –º–æ–º–µ–Ω—Ç–∞ —Ä–æ–∑—ã–≥—Ä—ã—à–∞. –í —Å–ª—É—á–∞–µ —Ñ–æ—Ä—Å-–º–∞–∂–æ—Ä–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä –≤–ø—Ä–∞–≤–µ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Å—Ä–æ–∫, —É–≤–µ–¥–æ–º–∏–≤ —É—á–∞—Å—Ç–Ω–∏–∫–∞.

    <div class="section">üìã –ü—Ä–æ—á–µ–µ</div>
    ‚Ä¢ –û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä –≤–ø—Ä–∞–≤–µ –∏–∑–º–µ–Ω—è—Ç—å –ø—Ä–∏–∑–æ–≤–æ–π —Ñ–æ–Ω–¥<br>
    ‚Ä¢ –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–æ–∑—ã–≥—Ä—ã—à–∞ —Å–ª—É—á–∞–µ–Ω –∏ –æ–∫–æ–Ω—á–∞—Ç–µ–ª–µ–Ω<br>
    ‚Ä¢ –ó–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –≤–µ–¥—É—Ç –∫ –¥–∏—Å–∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏
  </div>
  <div class="rules-notice">
    –ù–∞–∂–∏–º–∞—è ¬´–ü—Ä–∏–Ω–∏–º–∞—é –∏ —É—á–∞—Å—Ç–≤—É—é¬ª, –≤—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ —á—Ç–æ –æ–∑–Ω–∞–∫–æ–º–∏–ª–∏—Å—å —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ –∏ —Å–æ–≥–ª–∞—Å–Ω—ã —Å –Ω–∏–º–∏.
  </div>
  <button class="btn-primary" onclick="agreeAndPlay()">‚úÖ –ü—Ä–∏–Ω–∏–º–∞—é –∏ —É—á–∞—Å—Ç–≤—É—é</button>
</div>

<!-- –†–£–õ–ï–¢–ö–ê -->
<div class="screen hidden" id="wheelScreen">
  <div class="wh-title">üé∞ –†–æ–∑—ã–≥—Ä—ã—à</div>
  <p class="wh-sub">–ö—Ä—É—Ç–∏ –∏ –ø–æ–ª—É—á–∏ –±–æ–Ω—É—Å!</p>
  <div class="wheel-wrapper">
    <div class="wheel-pointer"></div>
    <canvas id="wheel" width="360" height="360"></canvas>
    <button class="center-hub" id="spinBtn" onclick="spin()">–ö–†–£–¢–ò!</button>
  </div>
  <div class="result-card" id="resultCard">
    <div class="result-label">–¢–≤–æ–π –ø—Ä–∏–∑</div>
    <div class="result-text" id="resultText">–ñ–º–∏ –∫–Ω–æ–ø–∫—É!</div>
    <div class="result-hint" id="resultHint"></div>
  </div>
  <button class="btn-claim" id="claimBtn" onclick="claimPrize()">üéÅ –ó–∞–±—Ä–∞—Ç—å –ø—Ä–∏–∑!</button>
</div>

<script>
const tg = window.Telegram?.WebApp;
if (tg) { tg.ready(); tg.expand(); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  –ü–†–ò–ó–´ ‚Äî —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π –∑–¥–µ—Å—å!
//  weight: –±–æ–ª—å—à–µ = —á–∞—â–µ –≤—ã–ø–∞–¥–∞–µ—Ç
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const PRIZES = [
  { label: "30% –Ω–∞\n—è–Ω–¥–µ–∫—Å –∞–∫–∫",      color: "#0e1a2e", accent: "#00C8FF", weight: 15 },
  { label: "+14 –¥–Ω–µ–π\n–≥–∞—Ä–∞–Ω—Ç–∏–∏",       color: "#0e2818", accent: "#A8FF3E", weight: 20 },
  { label: "15% –Ω–∞\n—Å–∞–π—Ç 16 –±–ª–æ–∫–æ–≤",  color: "#141428", accent: "#FFD700", weight: 8  },
  { label: "20% –Ω–∞\n—Å–∞–π—Ç 9 –±–ª–æ–∫–æ–≤",   color: "#1a0e2e", accent: "#FF6BCB", weight: 7  },
  { label: "15% –Ω–∞\n–∑–∞–ø–æ–ª–Ω. –∞–≤–∏—Ç–æ",   color: "#1a1208", accent: "#FF9F43", weight: 10 },
  { label: "15% –Ω–∞\n–≥–æ—Ç–æ–≤—ã–π –ø—Ä–æ—Ñ–∏",   color: "#141428", accent: "#B48FFF", weight: 15 },
  { label: "1 –æ—Ç–∑—ã–≤\n–±–µ—Å–ø–ª–∞—Ç–Ω–æ",      color: "#1a0e0e", accent: "#FF4444", weight: 5  },
  { label: "–ü—É—Å—Ç–æ–π\n—è–Ω–¥–µ–∫—Å –≤ –ø–æ–¥–∞—Ä–æ–∫",color: "#0d1a10", accent: "#3EFF9A", weight: 10, note: "üéÅ –ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –Ø–Ω–¥–µ–∫—Å" },
  { label: "5% –Ω–∞\n—è–Ω–¥–µ–∫—Å –∞–∫–∫",       color: "#141420", accent: "#C8A0FF", weight: 5  },
  { label: "20% –Ω–∞\n–∑–∞–ø–æ–ª–Ω. –∞–≤–∏—Ç–æ",   color: "#1a150e", accent: "#FFB347", weight: 5  },
];
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const canvas = document.getElementById('wheel');
const ctx = canvas.getContext('2d');
const N = PRIZES.length;
const ARC = (2 * Math.PI) / N;
const CX = canvas.width / 2, CY = canvas.height / 2, R = CX - 6;

let angle = 0, spinning = false, done = false, wonPrize = null;

function weightedRandom() {
  const total = PRIZES.reduce((s, p) => s + p.weight, 0);
  let r = Math.random() * total;
  for (let i = 0; i < N; i++) { r -= PRIZES[i].weight; if (r <= 0) return i; }
  return N - 1;
}

function drawWheel(a) {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  for (let i = 0; i < N; i++) {
    const s = a + i * ARC, e = s + ARC, p = PRIZES[i];
    ctx.beginPath(); ctx.moveTo(CX, CY); ctx.arc(CX, CY, R, s, e); ctx.closePath();
    ctx.fillStyle = p.color; ctx.fill();
    ctx.strokeStyle = '#08080f'; ctx.lineWidth = 2; ctx.stroke();
    ctx.beginPath(); ctx.arc(CX, CY, R - 8, s + 0.05, e - 0.05);
    ctx.strokeStyle = p.accent; ctx.lineWidth = 4; ctx.stroke();
    ctx.save();
    ctx.translate(CX, CY); ctx.rotate(s + ARC / 2);
    // text shadow for readability
    ctx.textAlign = 'right';
    ctx.shadowColor = 'rgba(0,0,0,0.8)';
    ctx.shadowBlur = 4;
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 13px Inter, sans-serif';
    p.label.split('\n').forEach((ln, li, arr) => {
      ctx.fillText(ln, R - 16, (li - (arr.length - 1) / 2) * 16 + 5);
    });
    ctx.restore();
  }
  ctx.beginPath(); ctx.arc(CX, CY, 32, 0, 2 * Math.PI);
  ctx.fillStyle = '#08080f'; ctx.fill();
  ctx.strokeStyle = '#222230'; ctx.lineWidth = 2; ctx.stroke();
}

drawWheel(angle);

function spin() {
  if (spinning || done) return;
  spinning = true; done = true;
  document.getElementById('spinBtn').disabled = true;

  const idx = weightedRandom();
  const sectorMid = idx * ARC + ARC / 2;
  const target = angle + (6 + Math.floor(Math.random() * 4)) * 2 * Math.PI
                 + ((-Math.PI / 2 - sectorMid - angle) % (2 * Math.PI) + 2 * Math.PI) % (2 * Math.PI);
  const dur = 5000, t0 = performance.now(), a0 = angle;
  const ease = t => 1 - Math.pow(1 - t, 4);

  (function frame(now) {
    const t = Math.min((now - t0) / dur, 1);
    angle = a0 + (target - a0) * ease(t);
    drawWheel(angle);
    if (t < 1) { requestAnimationFrame(frame); }
    else { showResult(PRIZES[idx]); }
  })(performance.now());
}

function showResult(p) {
  wonPrize = p;
  const card = document.getElementById('resultCard');
  const text = document.getElementById('resultText');
  const hint = document.getElementById('resultHint');
  const btn  = document.getElementById('claimBtn');
  const isLoss = p.accent === '#444455';

  card.classList.add('won');
  text.textContent = p.label.replace('\n', ' ');
  text.style.color = p.accent;

  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–∑–∞ ‚Äî –æ—Ç–ø—Ä–∞–≤–∏–º –±–æ—Ç—É —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–º—ë—Ç –∫–Ω–æ–ø–∫—É
  const prizeText = p.label.replace('\n', ' ') + (p.note ? ' (' + p.note.replace(/^[^\s]+\s/, '') + ')' : '');
  window._pendingPrize = prizeText;

  if (isLoss) {
    card.style.borderColor = '#333';
    hint.textContent = '–£–¥–∞—á–∞ –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑! üçÄ';
    btn.textContent = 'üëå –ü–æ–Ω—è—Ç–Ω–æ, –∑–∞–∫—Ä—ã—Ç—å';
    btn.style.cssText += ';background:#1a1a2e;color:#888;box-shadow:none;animation:none;';
  } else {
    if (p.note) {
      hint.innerHTML = `<span style="color:${p.accent};font-size:12px;font-weight:600;">${p.note}</span><br><span style="color:var(--muted)">–ë–æ—Ç –ø—Ä–∏—à–ª—ë—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ üéâ –ë–æ–Ω—É—Å ‚Äî 7 –¥–Ω–µ–π</span>`;
    } else {
      hint.textContent = '–ë–æ—Ç –ø—Ä–∏—à–ª—ë—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤ —á–∞—Ç üéâ –ë–æ–Ω—É—Å –¥–µ–π—Å—Ç–≤—É–µ—Ç 7 –¥–Ω–µ–π!';
    }
    btn.textContent = 'üéÅ –û—Ç–ª–∏—á–Ω–æ, –∑–∞–∫—Ä—ã—Ç—å!';
    confetti(p.accent);
  }
  btn.style.display = 'block';
}

function claimPrize() {
  if (tg && tg.sendData && window._pendingPrize) {
    try {
      tg.sendData(JSON.stringify({ prize: window._pendingPrize, ts: Date.now() }));
    } catch(e) {
      console.log('sendData error:', e);
      tg.close();
    }
  } else if (tg) {
    tg.close();
  }
}

function agreeAndPlay() {
  document.getElementById('rulesScreen').classList.add('hidden');
  document.getElementById('wheelScreen').classList.remove('hidden');
}

function confetti(accent) {
  const colors = ['#FFD700','#FF6BCB','#00C8FF','#A8FF3E','#FF9F43','#FF4444','#B48FFF', accent];
  const shapes = ['square', 'circle', 'star'];
  const total = 80;

  for (let i = 0; i < total; i++) {
    setTimeout(() => {
      const el = document.createElement('canvas');
      const size = 5 + Math.random() * 6;
      el.width = size * 2; el.height = size * 2;
      const c = el.getContext('2d');
      const color = colors[~~(Math.random() * colors.length)];
      const shape = shapes[~~(Math.random() * shapes.length)];

      c.fillStyle = color;
      if (shape === 'circle') {
        c.beginPath(); c.arc(size, size, size * 0.8, 0, Math.PI * 2); c.fill();
      } else if (shape === 'star') {
        c.save(); c.translate(size, size);
        c.beginPath();
        for (let j = 0; j < 5; j++) {
          const a = (j * 4 * Math.PI) / 5 - Math.PI / 2;
          j === 0 ? c.moveTo(Math.cos(a)*size*0.9, Math.sin(a)*size*0.9)
                  : c.lineTo(Math.cos(a)*size*0.9, Math.sin(a)*size*0.9);
        }
        c.closePath(); c.fill(); c.restore();
      } else {
        c.fillRect(size * 0.1, size * 0.1, size * 1.8, size * 1.8);
      }

      el.style.cssText = `
        position:fixed;
        left:${Math.random()*100}vw;
        top:-20px;
        pointer-events:none;
        z-index:5;
        opacity:1;
        transform-origin:center;
      `;
      document.body.appendChild(el);

      const dur = 2000 + Math.random() * 2000;
      const drift = (Math.random() - 0.5) * 150;
      const rotations = 360 * (2 + Math.random() * 3) * (Math.random() > 0.5 ? 1 : -1);
      const startTime = performance.now();

      (function animate(now) {
        const t = (now - startTime) / dur;
        if (t >= 1) { el.remove(); return; }
        const y = t * (window.innerHeight + 40);
        const x = drift * Math.sin(t * Math.PI * 2);
        const rot = rotations * t;
        const op = t > 0.7 ? 1 - (t - 0.7) / 0.3 : 1;
        el.style.transform = `translate(${x}px, ${y}px) rotate(${rot}deg)`;
        el.style.opacity = op;
        requestAnimationFrame(animate);
      })(performance.now());

    }, i * 25);
  }
}
</script>
</body>
</html>
